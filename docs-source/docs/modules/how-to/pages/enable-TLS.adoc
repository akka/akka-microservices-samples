= How to enable TLS for gRPC
:toc:
:toc-title: ON THIS PAGE
:toclevels: 2

include::partial$include.adoc[]

In the xref:shopping-microservices:index.adoc[Microservices Tutorial] there's a guide on creating a xref:shopping-microservices:grpc-server.adoc#_server[gRPC server] using link:{akka-http} and link:{akka-grpc}. That example, though, will only bind a server supporting plaintext HTTP.

Enabling TLS for gRPC doesn't differ from enabling TLS for other application protocols served over HTTP (HTTP/1.x or HTTP/2). You will need to follow these 3 steps:

. obtain a certificate
. create an `HttpsConnectionContext`
. setup the `Http` instance to use the `HttpsConnectionContext`

Follow the link:{akka-http}/server-side/server-https-support.html[documentation] for details on each of those steps.

Note that since gRPC requires HTTP/2, when you enable TLS for gRPC you also need to support https://en.wikipedia.org/wiki/Application-Layer_Protocol_Negotiation[Application-Layer Protocol Negotiation (ALPN)] to negotiate whether both client and server support HTTP/2. The JVM provides ALPN support starting from JDK 8u252. Make sure you run a JVM greater than that.

[NOTE]
---
See also: link:{akka-http}/current/server-side/http2.html#use-newserverat-bind-and-https[Use `newServerAt(...).bind()` and HTTPS].
---

== Consume gRPC services over TLS

When consuming a gRPC that's served over an encrypted (non `plaintext`) connection, you must setup the `GrpcClientSettings` to enable TLS and, optionally, reconfigure the `ssl-provider` if you want to fine tune what implementation to use. See the link:{akka-grpc}/client/configuration.html[documentation for gRPC Client Configuration] for all the details.

== Advanced configurations

If you want to link:{}/server-side/server-https-support.html#running-both-http-and-https[run both HTTP and HTTPS side by side] you must create two `Http` instances and bind each instance to a different port. Both instances should share a single `Route` instance.

